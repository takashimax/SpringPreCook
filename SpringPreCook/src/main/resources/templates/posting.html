<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>投稿ページ</title>
</head>

<body>
	<div th:insert="~{common/sourceList :: sourceList}"></div>
	<div th:replace="~{common/header :: header}"></div>
	<script type="text/javascript" th:src="@{/js/posting.js}"></script>
	<h2>投稿ページ</h2>
	<div class="container">
		<div class="card">
			<div class="card-body">
				<form class="form-horizontal" th:action="@{/posting}" method="post" enctype="multipart/form-data"
					th:object="${postingForm}">
					<div class="form-group">
						<label class="col-sm-2 control-label">件名</label>
						<div class="col-sm-10">
							<input class="form-control" type="text" 　 th:field="*{postingTitle}">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">レシピ概要</label>
						<div class="col-sm-10">
							<input class="form-control" type="text" 　 th:field="*{postingText}">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">完成イメージ</label>
						<div class="col-sm-10 checkbox">
							<input type="file" class="form-control" accept='image/*' onchange="previewImage(this)"
								th:field="*{imageUrl}">
						</div>
					</div>
					<div class="form-group">
						<table>
							<thead>
								<tr>
									<th>材料</th>
									<th>分量</th>
								</tr>
							</thead>
							<tbody>
								<tr id="testNo_input">
									<td>
										<div>
											<input class="materialName form-control" type="text"
												th:field="*{materialList[0].materialName}" />
										</div>
										<div id="materialName"></div>
									</td>
									<td>
										<div>
											<input class="materialQuantity form-control" type="text"
												th:field="*{materialList[0].materialQuantity}" />
										</div>
										<div id="materialQuantity"></div>
									</td>
									<td><button class="btn btn-primary rounded-pill" id="addInput" type="button"
											tabIndex="-1">＋</button></td>
								</tr>
						</table>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">調理手順</label>
						<div class="col-sm-10">
							<input type="number" th:field="*{detailOrder}" class="form-control" max="5" min="1"></input>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">調理過程イメージ</label>
						<div class="col-sm-10 checkbox">
							<input type="file" class="form-control" accept='image/*' onchange="previewImage(this)"
								th:field="*{detailImageUrl}">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">調理詳細</label>
						<div class="col-sm-10">
							<textarea type="text" th:field="*{postingDetailText}" 　class="form-control"></textarea>
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<button class="btn btn-primary mt-3">送信</button>
						</div>
					</div>
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				</form>
			</div>
		</div>
	</div>
	<div class="container" id="works">
		<h2>投稿一覧</h2>
		<th:block th:each="posting : ${postingList}">
			<div class="card-deck">
				<div class="card">
					<div class="card-header">
						<h5 class="card-title" th:text="${posting.postingTitle}"></h5>
					</div>
					<div class="card-body">
						<a th:href="@{/postingEdit/__${posting.id}__}">
							<img th:src="@{/img/{imageUrl}  (imageUrl = *{posting.imageUrl})}" class="card-img-top"
								alt="..." style="max-width: 12em;">
							<p class="card-text" th:text="${posting.postingText}"></p>
							<p class="card-text"><small class="text-muted"
									th:text="|投稿日：${#temporals.format(posting.createTime, 'yyyy/MM/dd')}|"></small></p>
						</a>
					</div>
				</div>
			</div>
		</th:block>
	</div>
	<a th:href="@{/}">▶ホームへ戻る</a>
	<script>
		function previewImage(obj) {
			var fileReader = new FileReader();
			fileReader.onload = (function () {
				document.getElementById('preview').src = fileReader.result;
			});
			fileReader.readAsDataURL(obj.files[0]);
		}
	</script>
	<script type="text/javascript">
		function addmaterialName() {
			var inputCount = document.getElementsByClassName("materialName form-control").length;
			var input = document.createElement("input");
			input.setAttribute("type", "text");
			input.setAttribute("id", "materialList" + inputCount + ".materialName");
			input.setAttribute("class", "materialName form-control");
			input.setAttribute("name", "materialList[" + inputCount + "].materialName")
			input.setAttribute("value", "");
			var ele = document.createElement("div");
			ele.appendChild(input);
			document.getElementById("materialName").appendChild(ele);
		};
		function addMaterilQuantity() {
			var inputCount = document.getElementsByClassName("materialQuantity form-control").length;
			var input = document.createElement("input");
			input.setAttribute("type", "text");
			input.setAttribute("id", "materialList" + inputCount + ".materialQuantity");
			input.setAttribute("class", "materialQuantity form-control");
			input.setAttribute("name", "materialList[" + inputCount + "].materialQuantity")
			input.setAttribute("value", "");
			var ele = document.createElement("div");
			ele.appendChild(input);
			document.getElementById("materialQuantity").appendChild(ele);
		};

		document.getElementById("addInput").addEventListener("click", function (e) {
			addmaterialName();
		}, false);
		document.getElementById("addInput").addEventListener("click", function (e) {
			addMaterilQuantity();
		}, false);

	</script>
</body>

</html>